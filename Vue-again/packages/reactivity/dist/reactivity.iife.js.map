{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../src/reactive.ts"],
  "sourcesContent": ["// import { isObject } from '@vue/shared'\r\n// console.log(isObject(1))\r\n\r\nexport {effect } from './effect'\r\nexport {reactive }from './reactive'", "export let activeEffect\r\nexport class ReactiveEffect {\r\n    parent\r\n    deps = new Set\r\n    active = true\r\n    constructor(public fn, public scheduler) {\r\n\r\n    }\r\n\r\n    run() {\r\n        if (!this.active) return this.fn()\r\n        try {\r\n            this.parent = activeEffect\r\n            activeEffect = this\r\n            return this.fn()\r\n        } finally {\r\n            activeEffect = this.parent\r\n            this.parent = null\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        this.active = false\r\n    }\r\n}\r\nexport function effect(fn, options: any = {}) {\r\n    const _effect = new ReactiveEffect(fn, (options.scheduler))\r\n    _effect.run()\r\n    const runner = _effect.run.bind(_effect)\r\n    runner.effect = _effect\r\n    return runner\r\n}\r\n\r\nconst targetMap = new Map()\r\nexport function track(target, key) {\r\n    // Map {target: Map{key: Set<activeEffect>}}\r\n    let objMap = targetMap.get(target)\r\n    if (!objMap) {\r\n        targetMap.set(target, (objMap = new Map()))\r\n    }\r\n    let keyMap = objMap.get(key)\r\n    if (!keyMap) {\r\n        objMap.set(key, (keyMap = new Set))\r\n    }\r\n    const shouldTrack = !keyMap.has(activeEffect)\r\n    if (shouldTrack && activeEffect) {\r\n        keyMap.add(activeEffect)\r\n        activeEffect.deps.add(keyMap)\r\n    }\r\n}\r\n\r\nexport function trigger(target, key) {\r\n    const objMap = targetMap.get(target)\r\n    if (objMap) {\r\n        const keySet = objMap.get(key)\r\n        if (keySet) {\r\n            keySet.forEach((effect) => {\r\n                // \u5F53\u524Deffect\u4E2D\u89E6\u53D1\u4FEE\u6539\u4E86\u540C\u4E00effect \r\n                if(effect !== activeEffect) {\r\n\r\n                    if(effect.scheduler) {\r\n                        effect.scheduler()\r\n                    } else {\r\n                        effect.run()\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }\r\n}", "import { track, trigger } from \"./effect\"\r\n\r\nconst cachSet = new Set()\r\n\r\nexport const enum ReactiveFlags {\r\n    isReactive = '__is__reactive'\r\n}\r\nexport function reactive(target) {\r\n    if(target[ReactiveFlags.isReactive]) {\r\n        return target\r\n    }\r\n    if(cachSet.has(target)) {\r\n        return target\r\n    }\r\n    cachSet.add(target)\r\n\r\n    const proxy = new Proxy(target, {\r\n        get(target, key, receiver){\r\n            if(key === ReactiveFlags.isReactive) {\r\n                return true\r\n            }\r\n            track(target, key)\r\n            return Reflect.get(target, key, receiver)\r\n        },\r\n        set(target, key, value, receiver) {\r\n            \r\n            const r = Reflect.set(target, key, value, receiver)\r\n            trigger(target, key)\r\n            return r\r\n        }\r\n    })\r\n    return proxy\r\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAO,MAAI;AACJ,6BAAqB;AAAA,IAIxB,YAAmB,IAAW,WAAW;AAAtB;AAAW;AAF9B,kBAAO,oBAAI;AACX,oBAAS;AAAA,IAGT;AAAA,IAEA,MAAM;AACF,UAAI,CAAC,KAAK;AAAQ,eAAO,KAAK,GAAG;AACjC,UAAI;AACA,aAAK,SAAS;AACd,uBAAe;AACf,eAAO,KAAK,GAAG;AAAA,MACnB,UAAE;AACE,uBAAe,KAAK;AACpB,aAAK,SAAS;AAAA,MAClB;AAAA,IACJ;AAAA,IAEA,OAAO;AACH,WAAK,SAAS;AAAA,IAClB;AAAA,EACJ;AACO,kBAAgB,IAAI,UAAe,CAAC,GAAG;AAC1C,UAAM,UAAU,IAAI,eAAe,IAAK,QAAQ,SAAU;AAC1D,YAAQ,IAAI;AACZ,UAAM,SAAS,QAAQ,IAAI,KAAK,OAAO;AACvC,WAAO,SAAS;AAChB,WAAO;AAAA,EACX;AAEA,MAAM,YAAY,oBAAI,IAAI;AACnB,iBAAe,QAAQ,KAAK;AAE/B,QAAI,SAAS,UAAU,IAAI,MAAM;AACjC,QAAI,CAAC,QAAQ;AACT,gBAAU,IAAI,QAAS,SAAS,oBAAI,IAAI,CAAE;AAAA,IAC9C;AACA,QAAI,SAAS,OAAO,IAAI,GAAG;AAC3B,QAAI,CAAC,QAAQ;AACT,aAAO,IAAI,KAAM,SAAS,oBAAI,KAAI;AAAA,IACtC;AACA,UAAM,cAAc,CAAC,OAAO,IAAI,YAAY;AAC5C,QAAI,eAAe,cAAc;AAC7B,aAAO,IAAI,YAAY;AACvB,mBAAa,KAAK,IAAI,MAAM;AAAA,IAChC;AAAA,EACJ;AAEO,mBAAiB,QAAQ,KAAK;AACjC,UAAM,SAAS,UAAU,IAAI,MAAM;AACnC,QAAI,QAAQ;AACR,YAAM,SAAS,OAAO,IAAI,GAAG;AAC7B,UAAI,QAAQ;AACR,eAAO,QAAQ,CAAC,YAAW;AAEvB,cAAG,YAAW,cAAc;AAExB,gBAAG,QAAO,WAAW;AACjB,sBAAO,UAAU;AAAA,YACrB,OAAO;AACH,sBAAO,IAAI;AAAA,YACf;AAAA,UACJ;AAAA,QACJ,CAAC;AAAA,MACL;AAAA,IACJ;AAAA,EACJ;;;ACnEA,MAAM,UAAU,oBAAI,IAAI;AAKjB,oBAAkB,QAAQ;AAC7B,QAAG,OAAO,oCAA2B;AACjC,aAAO;AAAA,IACX;AACA,QAAG,QAAQ,IAAI,MAAM,GAAG;AACpB,aAAO;AAAA,IACX;AACA,YAAQ,IAAI,MAAM;AAElB,UAAM,QAAQ,IAAI,MAAM,QAAQ;AAAA,MAC5B,IAAI,SAAQ,KAAK,UAAS;AACtB,YAAG,QAAQ,mCAA0B;AACjC,iBAAO;AAAA,QACX;AACA,cAAM,SAAQ,GAAG;AACjB,eAAO,QAAQ,IAAI,SAAQ,KAAK,QAAQ;AAAA,MAC5C;AAAA,MACA,IAAI,SAAQ,KAAK,OAAO,UAAU;AAE9B,cAAM,IAAI,QAAQ,IAAI,SAAQ,KAAK,OAAO,QAAQ;AAClD,gBAAQ,SAAQ,GAAG;AACnB,eAAO;AAAA,MACX;AAAA,IACJ,CAAC;AACD,WAAO;AAAA,EACX;",
  "names": []
}
