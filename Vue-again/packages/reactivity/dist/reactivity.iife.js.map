{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../src/reactive.ts", "../../shared/src/index.ts", "../src/computed.ts"],
  "sourcesContent": ["// import { isObject } from '@vue/shared'\r\n// console.log(isObject(1))\r\n\r\nexport {effect } from './effect'\r\nexport {reactive }from './reactive'\r\nexport { computed } from './computed'", "export let activeEffect\r\nexport class ReactiveEffect {\r\n    parent\r\n    deps = new Set\r\n    active = true\r\n    constructor(public fn, public scheduler) {\r\n\r\n    }\r\n\r\n    run() {\r\n        if (!this.active) return this.fn()\r\n        try {\r\n            this.parent = activeEffect\r\n            activeEffect = this\r\n            return this.fn()\r\n        } finally {\r\n            activeEffect = this.parent\r\n            this.parent = null\r\n        }\r\n    }\r\n\r\n    stop() {\r\n        this.active = false\r\n    }\r\n}\r\nexport function effect(fn, options: any = {}) {\r\n    const _effect = new ReactiveEffect(fn, (options.scheduler))\r\n    _effect.run()\r\n    const runner = _effect.run.bind(_effect)\r\n    runner.effect = _effect\r\n    return runner\r\n}\r\n\r\nconst targetMap = new Map()\r\nexport function track(target, key) {\r\n    // Map {target: Map{key: Set<activeEffect>}}\r\n    let objMap = targetMap.get(target)\r\n    if (!objMap) {\r\n        targetMap.set(target, (objMap = new Map()))\r\n    }\r\n    let keyMap = objMap.get(key)\r\n    if (!keyMap) {\r\n        objMap.set(key, (keyMap = new Set))\r\n    }\r\n    trackEffects(keyMap)\r\n}\r\nexport function trackEffects(keyMap) {\r\n    const shouldTrack = !keyMap.has(activeEffect)\r\n    if (shouldTrack && activeEffect) {\r\n        keyMap.add(activeEffect)\r\n        activeEffect.deps.add(keyMap)\r\n    }\r\n}\r\n\r\nexport function trigger(target, key) {\r\n    const objMap = targetMap.get(target)\r\n    if (objMap) {\r\n        const keySet = objMap.get(key)\r\n        triggerEffects(keySet)\r\n    }\r\n}\r\n\r\nexport function triggerEffects(keySet) {\r\n    if (keySet) {\r\n        keySet.forEach((effect) => {\r\n            // \u5F53\u524Deffect\u4E2D\u89E6\u53D1\u4FEE\u6539\u4E86\u540C\u4E00effect \r\n            if(effect !== activeEffect) {\r\n\r\n                if(effect.scheduler) {\r\n                    effect.scheduler()\r\n                } else {\r\n                    effect.run()\r\n                }\r\n            }\r\n        })\r\n    }\r\n}", "import { track, trigger } from \"./effect\"\r\n\r\nconst cachSet = new Set()\r\n\r\nexport const enum ReactiveFlags {\r\n    isReactive = '__is__reactive'\r\n}\r\nexport function reactive(target) {\r\n    if(target[ReactiveFlags.isReactive]) {\r\n        return target\r\n    }\r\n    if(cachSet.has(target)) {\r\n        return target\r\n    }\r\n    cachSet.add(target)\r\n\r\n    const proxy = new Proxy(target, {\r\n        get(target, key, receiver){\r\n            if(key === ReactiveFlags.isReactive) {\r\n                return true\r\n            }\r\n            track(target, key)\r\n            return Reflect.get(target, key, receiver)\r\n        },\r\n        set(target, key, value, receiver) {\r\n            \r\n            const r = Reflect.set(target, key, value, receiver)\r\n            trigger(target, key)\r\n            return r\r\n        }\r\n    })\r\n    return proxy\r\n}", "export function isObject(v) {\r\n    return typeof v === 'object' && v != null\r\n}", "import { ReactiveEffect, trackEffects, triggerEffects } from './effect';\r\nimport { isObject } from '@vue/shared';\r\nexport class ComputedImpl {\r\n    effect\r\n    _dirty = true\r\n    _value\r\n    dep = new Set\r\n    constructor(public getter, public setter) {\r\n        const callback = () => {\r\n            // console.log(1)\r\n            trackEffects(this.dep)\r\n            if (!this._dirty) {\r\n                this._dirty = true\r\n            }\r\n        }\r\n        this.effect = new ReactiveEffect(getter, callback)\r\n        this._value = this.effect.run()\r\n    }\r\n    // \u5728\u6B64\u65F6\u603B\u5171\u6709\u4E24\u4E2Aeffect\r\n    // \u4E00\u4E2A\u662Fcomputed \u4E00\u4E2A\u662F\u83B7\u53D6value\u503C\u5F97\r\n    // \u6211\u4EEC\u8981\u7ED9\u4ED6\u4FE9\u786E\u7ACB\u5173\u8054\u5173\u7CFB\r\n    // \u5373 \u83B7\u53D6value\u503C\u7684effect\u8981\u5B58\u50A8effect\r\n    // computed\u7684effect\u7684schedule \u8981\u5728value\u503C\u53D8\u5316\u65F6\u89E6\u53D1\r\n    get value() {\r\n        if (this._dirty) {\r\n            this._value = this.effect.run()\r\n            this._dirty = false\r\n            triggerEffects(this.dep)\r\n        }\r\n        return this._value\r\n    }\r\n\r\n    set value(v) {\r\n        this.setter(this._value)\r\n    }\r\n}\r\nexport function computed(getterOrOptions) {\r\n    let getter = getterOrOptions\r\n    let setter = () => { }\r\n    if (isObject(getterOrOptions)) {\r\n        getter = getter.get\r\n        setter = getter.set\r\n    }\r\n    return new ComputedImpl(getter, setter)\r\n}"],
  "mappings": "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",
  "names": []
}
