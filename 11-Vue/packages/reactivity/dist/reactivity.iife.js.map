{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../../shared/src/is-object.ts", "../src/reactive.ts", "../src/computed.ts", "../src/watch.ts", "../src/ref.ts"],
  "sourcesContent": ["// import { isObject } from \"@vue/shared\";\n// console.log(isObject({}));\n\nexport { effect } from \"./effect\";\nexport { reactive } from \"./reactive\";\nexport { computed } from \"./computed\";\nexport { watch } from \"./watch\";\nexport { ref, toRef, toRefs } from \"./ref\";\n", "// \u8FD9\u4E2A\u51FD\u6570\u7528\u4E0E  \u5F53\u8981\u91CD\u65B0\u6536\u96C6\u4E00\u4E2Aeffect\u7684\u4F9D\u8D56\u65F6\uFF0C \u6E05\u7A7A\u8FD9\u4E2Aeffect\u4E0A\u5173\u4E8E\u5F53\u524Deffect\u7684\u8BB0\u5F55\nfunction cleanupEffect(effect) {\n  const effects = effect.deps;\n  for (let index = 0; index < effects.length; index++) {\n    effects[index].delete(effect);\n  }\n  effect.deps.length = 0;\n}\nexport let activeEffect = undefined;\nexport class ActiveEffect {\n  active = true;\n  parent = undefined;\n  deps = []; // Set[activeEffect] deps\u4E2D\u5B58\u50A8\u4E86\u6D89\u53CA\u5230\u5F53\u524Deffect\u7684\u5C5E\u6027\n  constructor(public fn, public scheduler) { }\n  run() {\n    if (!this.active) {\n      return this.fn();\n    }\n    try {\n      // \u8FD9\u4E00\u6B65\u4E3B\u8981\u662F\u4E3A\u4E86\u5728effect\u5D4C\u5957\u60C5\u51B5\u4E0B\uFF0C\u5B58\u50A8\u4E0A\u4E00\u6B21activeEffect\n      this.parent = activeEffect;\n      activeEffect = this;\n      cleanupEffect(activeEffect);\n      return this.fn();\n    } finally {\n      // \u5728\u5F53\u524Deffect\u6267\u884C\u5B8C\u6210\u4E4B\u540E\u518D\u5C06activeEffect\u6307\u5411\u56DEactiveEffect\n      activeEffect = this.parent;\n      this.parent = undefined;\n    }\n  }\n  stop() {\n    if (this.active) {\n      cleanupEffect(this);\n      this.active = false;\n    }\n  }\n}\n\nexport function effect(cb, options: any = {}) {\n  // console.log(options);\n  const effectInstance = new ActiveEffect(cb, options.scheduler);\n  effectInstance.run();\n\n  const runner = effectInstance.run.bind(effectInstance);\n  runner.effect = effectInstance;\n  return runner;\n}\n\nconst targetMap = new WeakMap();\n// targetMap\u7684\u683C\u5F0F\n// {\u5BF9\u8C61: {key: Set[activeEffect]}}\nexport function track(target, type, key) {\n  if (activeEffect) {\n    // \u83B7\u53D6\u5BF9\u5E94\u5BF9\u8C61\u7684Map\u5BF9\u8C61\n    let depsMap = targetMap.get(target);\n    if (!depsMap) {\n      // Map\u5BF9\u8C61\u4E0D\u5B58\u5728\u5219\u521B\u5EFAmap\u5E76\u5B58\u50A8\n      targetMap.set(target, (depsMap = new Map()));\n    }\n    // \u901A\u8FC7\u5C5E\u6027\u4E4B\u83B7\u53D6set\n    let effectSet = depsMap.get(key);\n    if (!effectSet) {\n      // Set\u4E0D\u5B58\u5728\u5219\u521B\u5EFAset\u5E76\u5B58\u50A8\n      depsMap.set(key, (effectSet = new Set()));\n    }\n    trackEffects(effectSet);\n  }\n}\nexport function trackEffects(effectSet) {\n  // \u6027\u80FD\u4F18\u5316\u70B9 \u867D\u7136set\u53EF\u4EE5\u53BB\u91CD\uFF0C\u4F46\u662F\u5982\u679C\u660E\u77E5\u9053\u662F\u91CD\u590D\u7684\uFF0C\u8FD8\u5F80\u91CC\u9762\u52A0\u4E0D\u884C\n  let shouldTrack = !effectSet.has(activeEffect);\n  if (shouldTrack) {\n    // \u5C06\u5F53\u524D\u6D3B\u52A8\u7684effect\u653E\u5165\u7F13\u5B58\n    effectSet.add(activeEffect);\n    activeEffect.deps.push(effectSet); // \u5F53\u524D\u6D3B\u52A8\u7684effect\u6D89\u53CA\u5230\u4E86\u90A3\u4E9B\u5C5E\u6027\uFF0C\u90FD\u6536\u96C6\u5230deps\u4E2D\n  }\n}\n\nexport function trigger(target, type, key) {\n  const map = targetMap.get(target);\n  if (map) {\n    let effects = map.get(key);\n    triggerEffects(effects);\n  }\n}\n\nexport function triggerEffects(effects) {\n  effects = new Set(effects);\n  effects &&\n    effects.forEach((effect) => {\n      // console.log(effect === activeEffect);\n      // \u9632\u6B62effect\u89E6\u53D1\u672C\u8EABeffect \u65E0\u9650\u5FAA\u73AF\n      if (effect !== activeEffect) {\n        if (effect.scheduler) {\n          effect.scheduler();\n        } else {\n          effect.run();\n        }\n      }\n    });\n}\n", "export function isObject(v) {\n  return typeof v === \"object\" && v != null;\n}\n", "import { track, trigger } from \"./effect\";\nimport { isObject } from \"@vue/shared/\";\n\nexport let cache = new WeakMap();\nexport const enum TypeEnum {\n  ISReactive = \"__is__reactive\",\n}\nconst mutableHandlers = {\n  get(target, key, recevie) {\n    if (key === TypeEnum.ISReactive) {\n      return true;\n    }\n    const res = Reflect.get(target, key, recevie);\n    track(target, \"get\", key);\n    if (isObject(res)) {\n      return reactive(res);\n    }\n    return res;\n  },\n  set(target, key, value, recevie) {\n    const oldValue = target[key];\n    const res = Reflect.set(target, key, value, recevie);\n    if (oldValue !== value) {\n      trigger(target, \"set\", key);\n    }\n    return res;\n  },\n};\n\nexport function reactive(v) {\n  const exitProxy = cache.get(v);\n  if (exitProxy) {\n    return exitProxy;\n  }\n\n  if (v[TypeEnum.ISReactive]) {\n    return v;\n  }\n\n  const proxy = new Proxy(v, mutableHandlers);\n\n  cache.set(v, proxy);\n  return proxy;\n}\n", "import { isObject } from \"@vue/shared\";\nimport {\n  activeEffect,\n  ActiveEffect,\n  trackEffects,\n  triggerEffects,\n} from \"./effect\";\nclass ComputedRefImpl {\n  _dirty = true;\n  _value;\n  effect;\n  dep = new Set();\n  constructor(public getter, public setter) {\n    // \u6B64\u65F6\u8C03\u7528ActiveEffect \u662F\u4E3A\u4E86\u6267\u884Cgetter\u65B9\u6CD5\uFF0C\u4F7Feffect\u6536\u96C6\u4F9D\u8D56\uFF0C\u6709\u54EA\u4E9B\u5BF9\u8C61\u7684\u5C5E\u6027\u53D8\u5316\u4E4B\u540E\u89E6\u53D1effect\n    this.effect = new ActiveEffect(getter, () => {\n      // \u4E00\u65E6getter\u4E2D\u6D89\u53CA\u5230\u7684\u503C\u53D1\u751F\u53D8\u5316\u4E86 \u5C31\u4F1A\u89E6\u53D1scheduler\u8FD9\u4E2A\u65F6\u5019\u5C06dirty\u8BBE\u4E3Atrue \u5E76\u6267\u884C\n      if (!this._dirty) {\n        this._dirty = true;\n        // dep \u4E2D\u5B58\u50A8\u7684\u662F\u548C\u8BA1\u7B97\u5C5E\u6027value\u76F8\u5173\u7684effect \u6240\u4EE5\u8981\u6279\u91CF\u6267\u884C\n        triggerEffects(this.dep);\n      }\n    });\n  }\n\n  get value() {\n    //   get\u65F6 \u8981\u5C06\u5F53\u524DactiveEffect\u5B58\u50A8\u5230dep\u4E2D\n    if (activeEffect) {\n      // \u5C06\u5F53\u524D\u7684effect\u5B58\u50A8\u5230dep\u4E2D\n      trackEffects(this.dep);\n    }\n    if (this._dirty) {\n      this._dirty = false;\n      this._value = this.effect.run();\n    }\n    return this._value;\n  }\n  set value(v) {\n    this.setter(v);\n  }\n}\n\nexport function computed(getterOrOptions) {\n  let getter = getterOrOptions;\n  let setter = () => {};\n  if (isObject(getterOrOptions)) {\n    getter = getterOrOptions.get;\n    setter = getterOrOptions.set;\n  }\n\n  return new ComputedRefImpl(getter, setter);\n}\n", "import { isObject } from \"@vue/shared\";\nimport { ActiveEffect } from \"./effect\";\nimport { TypeEnum } from \"./reactive\";\nconst tranverse = (obj, set = new Set()) => {\n  if (isObject(obj)) {\n    if (set.has(obj)) {\n      return obj;\n    }\n    set.add(obj);\n    for (const key in obj) {\n      return tranverse(obj[key]);\n    }\n  } else {\n    return obj;\n  }\n};\nexport function isReactive(v) {\n  return !!(v && v[TypeEnum.ISReactive]);\n}\nexport function watch(objOrFn, callback) {\n  let getter;\n  if (isReactive(objOrFn)) {\n    getter = () => {\n      // getter \u4E3B\u8981\u662F\u4E3A\u4E86\u6536\u96C6\u4F9D\u8D56\n      return tranverse(objOrFn);\n    };\n  } else {\n    getter = objOrFn;\n  }\n  let oldValue;\n  let clear;\n  let cleanup = (fn) => {\n    clear = fn;\n  };\n  const cb = () => {\n    clear && clear();\n    const newValue = effect.run();\n    callback(newValue, oldValue, cleanup);\n    oldValue = newValue;\n  };\n  const effect = new ActiveEffect(getter, cb);\n  oldValue = effect.run();\n}\n", "import { isObject } from \"@vue/shared\";\nimport { reactive } from \"./reactive\";\nimport { activeEffect, trackEffects, triggerEffects } from \"./effect\";\nconst toReactive = (v) => {\n  return isObject(v) ? reactive(v) : v;\n};\nclass RefImpl {\n  _value;\n  dep = new Set();\n  __v_isRef = true;\n  constructor(public rawValue) {\n    this._value = toReactive(rawValue);\n  }\n\n  get value() {\n    if (activeEffect) {\n      // \u6536\u96C6\u4F9D\u8D56\n      trackEffects(this.dep);\n    }\n    return this._value;\n  }\n  set value(v) {\n    this._value = v;\n    //   \u89E6\u53D1\u4F9D\u8D56\n    triggerEffects(this.dep);\n  }\n}\nexport function ref(v) {\n  return new RefImpl(v);\n}\n\nclass ObjectRefImpl {\n  public __v_isRef = true;\n  constructor(public target, public key) {}\n  get value() {\n    return this.target[this.key];\n  }\n  set value(v) {\n    this.target[this.key] = v;\n  }\n}\n\nexport function toRef(target, key) {\n  return new ObjectRefImpl(target, key);\n}\n\nexport function toRefs(v) {\n  const result = Array.isArray(v) ? [] : {};\n  for (const key in v) {\n    result[key] = toRef(v, key);\n  }\n  return result;\n}\n"],
  "mappings": "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",
  "names": []
}
